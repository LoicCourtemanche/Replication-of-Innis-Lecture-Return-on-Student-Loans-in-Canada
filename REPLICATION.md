# caje.12561 Innis Lecture: Return on Student Loans in Canada Validation and Replication results

> Some useful links:
> - [Official Data and Code Availability Policy](https://www.aeaweb.org/journals/policies/data-code)
> - [Step by step guidance](https://aeadataeditor.github.io/aea-de-guidance/) 
> - [Template README](https://social-science-data-editors.github.io/template_README/)


## SUMMARY


### Action Items (manuscript)


### Action Items (openICPSR)

-----action items go here------

> INSTRUCTION: leave this in.

> The openICPSR submission process has changed. If you have not already done so, please "Change Status -> Submit to AEA" from your deposit Workspace.

> [NOTE] Since July 1, 2021, we will publish replication packages as soon as all requested changes to the deposit have been made. Please process any requested changes as soon as possible.

> INSTRUCTION: ALWAYS do "Data description", "Code description". If data is present, ALWAYS do "Data checks". If time is sufficient (initial assessment!), do "Replication steps", if not, explain why not.


## General

- [X] Data Availability and Provenance Statements
  - [X] Statement about Rights
  - [X] License for Data
  - [ ] Details on each Data Source
- [ ] Dataset list
- [ ] Computational requirements
  - [ ] Software Requirements
  - [ ] Controlled Randomness
  - [ ] Memory and Runtime Requirements
- [X] Description of programs/code
  - [ ] (Optional, but recommended) License for Code
- [X] Instructions to Replicators
  - [ ] Details
- [X] List of tables and programs
- [X] References

> [REQUIRED] As specified in the [Policy](https://www.aeaweb.org/journals/data/data-code-policy) and the [DCAF](https://www.aeaweb.org/journals/forms/data-code-availability), the README shall follow the schema provided by the [Social Science Data Editors' template README](https://social-science-data-editors.github.io/guidance/template-README.html).


## Data description


### Data Sources

[CSLP]
- CSLP PCPE repayment f1 v1.dta (not provided)
- CSLP PCPE disbursement f1 v1.dta (not provided)
- CSLP PCPE needs f1 v1.dta (not provided)

> Employment and Social Development Canada (ESDC). 2021. Canada Student Loans Program 2003–2004 to 2015–2016. Canadian Research Data Centre Network, last accessed 2021-09-02.

- Repayment Post Default and Post Rehabilitation data.xlsx
> The source is missing


### Analysis Data Files

- [ ] No analysis data file mentioned
- [ ] Analysis data files mentioned, not provided (explain reasons below)
- [X] Analysis data files mentioned, provided. File names listed below.

-frac_def.dta: This data file is generated by “create default data.do”. It contains the
statistics that we use to impute payments after default (online appendix Table C1 and
Table C2).
- frac_rehab.dta: This data file is generated by “create default data.do”. It contains
the statistics that we use to impute payments after default (online appendix Table C3)


## Data deposit

> INSTRUCTIONS: Most deposits will be at openICPSR, but all need to be checked for complete metadata. Detailed guidance is at [https://aeadataeditor.github.io/aea-de-guidance/](https://aeadataeditor.github.io/aea-de-guidance/). 


### Requirements 

> INSTRUCTIONS: Check that these requirements are met. 

- [X] README is in TXT, MD, PDF format
- [X] Deposit has no ZIP files
- [X] Title conforms to guidance (starts with "Data and Code for:" or "Code for:", is properly capitalized)
- [X] Authors (with affiliations) are listed in the same order as on the paper


### Deposit Metadata

- [X] JEL Classification (required)
- [X] Manuscript Number (required)
- [X] Subject Terms (highly recommended)
- [ ] Geographic coverage (highly recommended)
- [ ] Time period(s) (highly recommended)
- [ ] Collection date(s) (suggested)
- [ ] Universe (suggested)
- [ ] Data Type(s) (suggested)
- [ ] Data Source (suggested)
- [ ] Units of Observation (suggested)

- [SUGGESTED] We suggest you update the openICPSR metadata fields marked as (highly recommended), in order to improve findability of your data and code supplement. 
- [SUGGESTED] We suggest you update the openICPSR metadata fields marked as (suggested), in order to improve findability of your data and code supplement. 


## Data checks

> INSTRUCTIONS: When data are present, run checks:
> - can data be read (using software indicated by author)?
> - Are datasets in archive-ready formats (CSV, TXT) or in custom formats (DTA, SAS7BDAT, Rdata)? Note: Numbers and Mathematica data files are not considered archive-safe and cannot be accepted. 
> - Do the data files have variable labels (Stata: run `describe using (name of DTA)` and check that there is content in the column "variable label")?
> - Run check for PII ([PII_stata_scan.do](PII_stata_scan.do), sourced from [here](https://github.com/J-PAL/stata_PII_scan) if using Stata) and report results. Note: this check will have lots of false positives - fields it thinks might be sensitive that are not, in fact, sensitive. Apply judgement.


## Code description

- clean CSLP repayment.do: This program cleans the raw repayment file.
- clean CSLP disbursement.do: This program cleans the raw disbursement file.
- clean CSLP needs.do: This program cleans the raw needs assessment file.
- clean repay by cohort.do: This program further cleans the repayment file by last consolidation year.
- calc repay case3.do: This program calculates annual payments for inconsistent cases where payments were made prior to the last loan consolidation.
- calc repay other.do: This program calculates annual payments for all other cases.
- calc default.do: This program imputes payments after default.
- predict payments.do: This program runs Tobit regressions and imputes payments after the observed period for borrowers who do not have the full repayment history.
- calc return.do: This program calculates the realized return.
- return analysis.do: This program generates return statistics and runs return regressions.
- rank cslp.do: This program labels the institutions.
- robust sample.do: This program generates statistics for different samples (online appendix Table A1).
- create default data.do: This program reads data from the file “Repayment Post

[Tables and figures in the main paper]
Table/figure in paper - Program(s) generating output
Figure 1 -> return analysis.do
Figure 2 -> return analysis.do
Figure 3 -> return analysis.do
Figure 4 -> return analysis.do
Table 1 -> return analysis.do
Table 2 -> return analysis.do
Table 3 -> return analysis.do
Table 4 -> return analysis.do
Table 5 -> return analysis.do

[Tables in the online appendices]
Table in appendix - Program(s) generating output
Table A1 -> return analysis.do, robust sample.do
Table B1 -> predict payments.do
Table E1 -> return analysis.do


## Missing Requirements

- [X Software Requirements
  - [X] Stata
    - Stata 16
- [X] Computational Requirements specified as follows:
  - Cluster size, disk size, memory size, etc.
- [X] Time Requirements 
  - 20 minutes

## Computing Environment of the Replicator

## Replication steps

> INSTRUCTIONS: provide details about your process of accessing the code and data.
> Do NOT detail things like "I save them on my Desktop".
> DO describe actions   that you did  as per instructions ("I added a config.do")
> DO describe any other actions you needed to do ("I had to make changes in multiple programs"), without going into detail (the commit log can provide that information)

1. Every file call in the program has been put between ""

In the "main.do" file:
1. Change Change : {global project "."} by {global project "$replication"}
2. Add this code at the line 6
-------------Code-------------
************************************
//Replication modification
************************************

set dp comma , perm

global replication "M:\Equipes\Projet 10054\Replication\courloi10054\Improvement"

version 16

log using "replication.log", name(replication) replace
timer on 1

local variant = cond(c(MP),"MP",cond(c(SE),"SE",c(flavor)) )   

di _newline(2) "Replication done by :"				///
_newline "Loïc Courtemanche - L.courtemanche@outlook.com"	///
_newline "`c(current_date)' at `c(current_time)'"		///
_newline(2) "======= SYSTEM DIAGNOSTICS =======" 		///
_newline "Stata version: `c(stata_version)'" 			///
_newline "Updated as of: `c(born_date)'" 			///
_newline "Variant:       `variant'" 				///
_newline "Processors:    `c(processors)'" 			///
_newline "OS:            `c(os)' `c(osdtl)'" 			///
_newline "Machine type:  `c(machine_type)'" 			///
_newline "=================================="

*Create folder for ours results
capture mkdir results
capture mkdir "C:/Users/courloi2/data/cleaned"


************************************
//Ends of replication modification
************************************
-------------End of Code-------------

3. Add this code a the main of the "main.do"
-------------	Code	-------------
timer off 1
timer list
capture log close _all
-------------End of Code-------------

In the "clean_CSLP_disbursement.do" file:
1. Add : 
	/*	== code ==  */
	//make all variable name lowercase
	foreach v of varlist _all{
		capture rename `v' `=lower("`v'")'
	}
	/*	== code ==  */
	
In the "clean_CSLP_needs.do" file:
1. Add : 
	/*	== code ==  */
	//make all variable name lowercase
	foreach v of varlist _all{
		capture rename `v' `=lower("`v'")'
	}
	/*	== code ==  *

In the "clean_CSLP_needs.do" file:
1: Add in "statistics in Table 1 & 2"  (line 122)
	/*	== code ==  */
	gen All = 1
	table All, c(n undergrad_return  mean undergrad_return semean undergrad_return mean default_3yr mean rap_3yr)
	/*	== code ==  */

2: For table 5, change the line "// sum undergrad_return [weight=loandisb]" for "sum undergrad_return [weight=loandisb]"

## Improvement steps
From the orignal files of the autors:

1. For all file name and path call in the do files they have been put in ""
------------------------------------
Main.do
------------------------------------
1. Replication modification
/*	== code ==  */
************************************
//Replication modification
************************************

set dp comma , perm

global replication "M:\Equipes\Projet 10054\Replication\courloi10054\Improvement"

version 16

log using "replication.log", name(replication) replace
timer on 1

local variant = cond(c(MP),"MP",cond(c(SE),"SE",c(flavor)) )   

di _newline(2) "Replication done by :"					///
_newline "Loïc Courtemanche - L.courtemanche@outlook.com"		///
_newline "`c(current_date)' at `c(current_time)'"			///
_newline(2) "======= SYSTEM DIAGNOSTICS =======" 			///
_newline "Stata version: `c(stata_version)'" 				///
_newline "Updated as of: `c(born_date)'" 				///
_newline "Variant:       `variant'" 					///
_newline "Processors:    `c(processors)'" 				///
_newline "OS:            `c(os)' `c(osdtl)'" 				///
_newline "Machine type:  `c(machine_type)'" 				///
_newline "=================================="

*Create folder for ours results
capture mkdir results
capture mkdir "C:/Users/courloi2/data/cleaned"


************************************
//Ends of replication modification
************************************
/*	== code ==  */

2. Change path
3. Add : cd "$project"
4. baseline sample analysis
	/*	== code ==  */
	//baseline sample analysis
	if ($check_sample==0) {
		*Create globals to test for news results
		*predict_payments.do -> test for other values
		foreach rrate of numlist 0.045 0.05 0.055 0.06 0.065  {							// 0.055 is the original value	
			global rrate `rrate'
			global nrrate = `rrate'*1000		
			
			//impute payments beyond data periods
			do "predict_payments"

			//calculate return
			do "calc_return"
			
			foreach Cohort of numlist  2003 2004 2005 2006 2007 2008 {					// 2005 is the original value
				global Cohort `Cohort'
				//return statistics, regressions
				do "return_analysis"
			}
		}
	}
	/*	== code ==  */
5. Add at the end
	/*	== code ==  */
		timer off 1
		timer list
		log close _all
	/*	== code ==  */
	
------------------------------------
clean_CSLP_disbursement.do
------------------------------------	
1. Add at line 8 : 
	/*	== code ==  */
	//make all variable name lowercase
	foreach v of varlist _all{
		capture rename `v' `=lower("`v'")'
	}
	/*	== code ==  */
	
------------------------------------
clean_CSLP_needs.do
------------------------------------	
1. Add at line 8 : 
	/*	== code ==  */
	//make all variable name lowercase
	foreach v of varlist _all{
		capture rename `v' `=lower("`v'")'
	}
	/*	== code ==  */
	
------------------------------------
predict_payments.do
------------------------------------	
1. Change "sca rrate=0.055" for "sca rrate=${rrate}" line 16

------------------------------------
return_analysis.do
------------------------------------
1: Add : capture log using "results/return_analysis ${Cohort} rrate ${nrrate}" , replace t name(ReturnA)
2: Change "keep if cohort==2005" for "keep if cohort==${Cohort}"
3: Change "keep if (yearstudy==3 & last_yearcons<=2008)|(yearstudy==4 & last_yearcons<=2007)" for "keep if (yearstudy==3 & last_yearcons<=(${Cohort}+3))|(yearstudy==4 & last_yearcons<=(${Cohort}+2))"
4: Add in "statistics in Table 1 & 2" 
	/*	== code ==  */
	gen All = 1
	table All, c(n undergrad_return  mean undergrad_return semean undergrad_return mean default_3yr mean rap_3yr)
	/*	== code ==  */
5. Add : "graph save "results/Fig 4 ${Cohort} rrate ${nrrate}" , replace"
6. Add : "graph save "results/Fig 3 ${Cohort} rrate ${nrrate}" , replace"
7: Add at the end : capture log close ReturnA${Cohort}
8: Replace in table 5 section : "// sum undergrad_return [weight=loandisb]" by "sum undergrad_return [weight=loandisb] "

## Findings

> INSTRUCTIONS: Describe your findings both positive and negative in some detail, for each **Data Preparation Code, Figure, Table, and any in-text numbers**. You can re-use the Excel file created under *Code Description*. When errors happen, be as precise as possible. For differences in figures, provide both a screenshot of what the manuscript contains, as well as the figure produced by the code you ran. For differences in numbers, provide both the number as reported in the manuscript, as well as the number replicated. If too many numbers, contact your supervisor.

Replication findings:
Most results are produce by the proram. All the figure look similar and the small difference in the tables are cause by the rounding of the result with the purpose to keep a diférencebetween result that will disapeared if they were rouded normaly. Fictitious example: Result 1 is 0,005 and result 2 is 0,014. Both should be round to 0,01 but the autors choose to round one to 0,01 and the other to 0,00 (or 0,02) depending on the case to preserved the gap of nearly 0,01 between the two results. Those unusual rounding do not affect the conclusion of the paper. 

The first row of the table 1 is not produce by the program, but can be extract by a little modification stated previously. (step 1 of "clean_CSLP_needs.do" modification in "Replication steps") 
The result dispaly in the first row and first column of the table 5 is produced by a line of code that has been commented out of the code. (step 2 of "clean_CSLP_needs.do" modification in "Replication steps")

The IRR result in the table are not produce by the program. Event if those result are not essential for maintaining the conclusions reached in the paper, they should nevertheless be produced by the code.

Improvement findings:

Two robustess check have been conduct on the code. The first one was to change the interrest rate use in "predict_payments.do" since the reason why they choose 5.5 % is not explain. The second robustness check run on this code was to apply the same methodology for all the available cohort in the dataset. 

For the interrest rates robusness check, the conclusion are not affected by a change from 4.5 % to 6.5 %. The results are also lightly affected by that change. For the others cohortes, the  

### Data Preparation Code

### Tables
Table 1: All results are identical, except for the IRR which is not produced by the code
Table 2: All results are identical, except for the IRR which is not produced by the code
Table 3: All results are identical
Table 4: All results are identical
Table 5: All results are identical, except for the IRR which is not produced by the code

notes: Some results are not rounded correctly according to the standard, but the reason why this was done seems to be to preserve a difference between two results which would disappear due to rounding. It doesn't affect the conclusion of the paper. 

### Figures

Figure 1: There is no visible difference

Figure 2: There is no visible difference

Figure 3: There is no visible difference

Figure 4: There is no visible difference


### In-Text Numbers

> INSTRUCTIONS: list page and line number of in-text numbers. If ambiguous, cite the surrounding text, i.e., "the rate fell to 52% of all jobs: verified".

[X] There are no in-text numbers, or all in-text numbers stem from tables and figures.

[ ] There are in-text numbers, but they are not identified in the code


## Classification

- [ ] full reproduction
- [ ] full reproduction with minor issues
- [X] partial reproduction (see above)
- [ ] not able to reproduce most or all of the results (reasons see above)


### Reason for incomplete reproducibility

- [ ] `Discrepancy in output` (either figures or numbers in tables or text differ)
- [ ] `Bugs in code`  that  were fixable by the replicator (but should be fixed in the final deposit)
- [X] `Code missing`, in particular if it  prevented the replicator from completing the reproducibility check
  - [ ] `Data preparation code missing` should be checked if the code missing seems to be data preparation code
- [X] `Code not functional` is more severe than a simple bug: it  prevented the replicator from completing the reproducibility check
- [ ] `Software not available to replicator`  may happen for a variety of reasons, but in particular (a) when the software is commercial, and the replicator does not have access to a licensed copy, or (b) the software is open-source, but a specific version required to conduct the reproducibility check is not available.
- [ ] `Insufficient time available to replicator` is applicable when (a) running the code would take weeks or more (b) running the code might take less time if sufficient compute resources were to be brought to bear, but no such resources can be accessed in a timely fashion (c) the replication package is very complex, and following all (manual and scripted) steps would take too long.
- [ ] `Data missing` is marked when data *should* be available, but was erroneously not provided, or is not accessible via the procedures described in the replication package
- [ ] `Data not available` is marked when data requires additional access steps, for instance purchase or application procedure. 
